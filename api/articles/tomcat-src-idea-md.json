{"title":"tomcat_src_idea.md","slug":"tomcat-src-idea-md","date":"2021-03-26T03:38:08.000Z","updated":"2021-03-26T05:15:39.350Z","comments":true,"excerpt":"","content":"<h3 id=\"在IDEA查看Tomcat代码-并编译成功\"><a href=\"#在IDEA查看Tomcat代码-并编译成功\" class=\"headerlink\" title=\"在IDEA查看Tomcat代码,并编译成功\"></a>在IDEA查看Tomcat代码,并编译成功</h3><p>这里我只是想看代码,看他编译成功就好</p>\n<pre><code class=\"bash\"> git clone git@github.com:apache/tomcat.git\n #这里就用8.5了\n git checkout 8.5.x\n cd tomcat\n mkdir catalina-home\n cp -rf conf webapps catalina-home\n touch pom.xml\n</code></pre>\n<p>在IDEA中导入tomcat目录, pom添加如下文件</p>\n<pre><code class=\"xml\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;\n    &lt;artifactId&gt;Tomcat8.0&lt;/artifactId&gt;\n    &lt;name&gt;Tomcat7.0&lt;/name&gt;\n    &lt;version&gt;8.0&lt;/version&gt;\n\n    &lt;build&gt;\n        &lt;finalName&gt;Tomcat8.0&lt;/finalName&gt;\n        &lt;sourceDirectory&gt;java&lt;/sourceDirectory&gt;\n        &lt;testSourceDirectory&gt;test&lt;/testSourceDirectory&gt;\n        &lt;resources&gt;\n            &lt;resource&gt;\n                &lt;directory&gt;java&lt;/directory&gt;\n            &lt;/resource&gt;\n        &lt;/resources&gt;\n        &lt;testResources&gt;\n            &lt;testResource&gt;\n                &lt;directory&gt;test&lt;/directory&gt;\n            &lt;/testResource&gt;\n        &lt;/testResources&gt;\n        &lt;plugins&gt;\n\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.8.1&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;\n                    &lt;source&gt;1.8&lt;/source&gt;\n                    &lt;target&gt;1.8&lt;/target&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;junit&lt;/groupId&gt;\n            &lt;artifactId&gt;junit&lt;/artifactId&gt;\n            &lt;version&gt;4.12&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.easymock&lt;/groupId&gt;\n            &lt;artifactId&gt;easymock&lt;/artifactId&gt;\n            &lt;version&gt;3.4&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.ant&lt;/groupId&gt;\n            &lt;artifactId&gt;ant&lt;/artifactId&gt;\n            &lt;version&gt;1.10.9&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;wsdl4j&lt;/groupId&gt;\n            &lt;artifactId&gt;wsdl4j&lt;/artifactId&gt;\n            &lt;version&gt;1.6.2&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;javax.xml&lt;/groupId&gt;\n            &lt;artifactId&gt;jaxrpc&lt;/artifactId&gt;\n            &lt;version&gt;1.1&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.eclipse.jdt.core.compiler&lt;/groupId&gt;\n            &lt;artifactId&gt;ecj&lt;/artifactId&gt;\n            &lt;version&gt;4.5.1&lt;/version&gt;\n        &lt;/dependency&gt;\n\n    &lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre>\n<p>然后就可以以maven项目导入idea了, idea也会主动识别, 不主动的话就右键pom.xml文件会有选项, 然后可以执行 <code>mvn compile</code> 成功变异了, 就可以愉快地在IDEA看tomcat源码了</p>\n<p>Main class设置为org.apache.catalina.startup.Bootstrap</p>\n<p>添加VM options </p>\n<p>-Dcatalina.home=catalina-home </p>\n<p>-Dcatalina.base=catalina-home </p>\n<p>-Djava.endorsed.dirs=catalina-home/endorsed </p>\n<p>-Djava.io.tmpdir=catalina-home/temp </p>\n<p>-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager </p>\n<p>-Djava.util.logging.config.file=catalina-home/conf/logging.properties</p>\n<p>说明：如果编译build的时候出现Test测试代码报错，注释该代码即可。本文中的Tomcat源码util.TestCookieFilter类会报错，将其注释即可。</p>\n<p>四、启动项目<br>上面第三步已经构建了项目的运行环境，点击运行或者调试按钮后，正常运行。</p>\n<p>项目启动完毕我们可以测试了，在浏览器访问<a href=\"http://localhost:8080/\" target=\"_blank\" rel=\"external\">http://localhost:8080/</a>  发现打不开我们看到的经典欢迎页面了，页面报了一个错</p>\n<p>原因是我们直接启动org.apache.catalina.startup.Bootstrap的时候没有加载org.apache.jasper.servlet.JasperInitializer，从而无法编译JSP。解决办法是在tomcat的源码org.apache.catalina.startup.ContextConfig中手动将JSP解析器初始化：</p>\n<p>line 776: context.addServletContainerInitializer(new JasperInitializer(), null);</p>\n","categories":[],"tags":[]}