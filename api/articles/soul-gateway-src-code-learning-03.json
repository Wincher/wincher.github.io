{"title":"soul_gateway_src_code_learning_03","slug":"soul-gateway-src-code-learning-03","date":"2021-01-16T18:26:10.000Z","updated":"2021-01-26T07:50:41.711Z","comments":true,"excerpt":"","content":"<h3 id=\"SOUL-Dubbo-demo\"><a href=\"#SOUL-Dubbo-demo\" class=\"headerlink\" title=\"SOUL Dubbo demo\"></a>SOUL Dubbo demo</h3><p>使用dubbo插件, 访问 <a href=\"http://127.0.0.1:9095/#/system/plugin\" target=\"_blank\" rel=\"external\">http://127.0.0.1:9095/#/system/plugin</a> 可以看到 dubbo 插件默认是</p>\n<p><img src=\"/2021/01/17/soul-gateway-src-code-learning-03/01turn_on.jpg\" alt=\"img\"></p>\n<p>点击editor </p>\n<p><img src=\"/2021/01/17/soul-gateway-src-code-learning-03/00dubbo_plugin.png\" alt=\"img\"></p>\n<p>开启dubbo plugin</p>\n<p>启动 zk,我用的docker <code>docker run -p 2181:2181 --restart unless-stopped --name zk -d zookeeper</code></p>\n<p>IDEA中运行 soul-examples/soul-examples-dubbo/soul-examples-apache-dubbo-service/src/main/java/org/dromara/soul/examples/apache/dubbo/service/TestApacheDubboApplication.java</p>\n\n    <pre><code class=\"lang-shell\"><span class=\"hljs-number\">2021</span>-<span class=\"hljs-number\">01</span>-<span class=\"hljs-number\">17</span> <span class=\"hljs-number\">02</span>:<span class=\"hljs-number\">55</span>:<span class=\"hljs-number\">52.742</span>  INFO <span class=\"hljs-number\">38578</span> --- [pool-<span class=\"hljs-number\">2</span>-thread-<span class=\"hljs-number\">1</span>] o.d.s.client.common.utils.RegisterUtils  : dubbo client register success: {<span class=\"hljs-string\">\"appName\"</span>:<span class=\"hljs-string\">\"dubbo\"</span>,<span class=\"hljs-string\">\"contextPath\"</span>:<span class=\"hljs-string\">\"/dubbo\"</span>,<span class=\"hljs-string\">\"path\"</span>:<span class=\"hljs-string\">\"/dubbo/findAll\"</span>,<span class=\"hljs-string\">\"pathDesc\"</span>:<span class=\"hljs-string\">\"Get all data\"</span>,<span class=\"hljs-string\">\"rpcType\"</span>:<span class=\"hljs-string\">\"dubbo\"</span>,<span class=\"hljs-string\">\"serviceName\"</span>:<span class=\"hljs-string\">\"org.dromara.soul.examples.dubbo.api.service.DubboTestService\"</span>,<span class=\"hljs-string\">\"methodName\"</span>:<span class=\"hljs-string\">\"findAll\"</span>,<span class=\"hljs-string\">\"ruleName\"</span>:<span class=\"hljs-string\">\"/dubbo/findAll\"</span>,<span class=\"hljs-string\">\"parameterTypes\"</span>:<span class=\"hljs-string\">\"\"</span>,<span class=\"hljs-string\">\"rpcExt\"</span>:<span class=\"hljs-string\">\"{\\\"</span><span class=\"hljs-built_in\">group</span>\\<span class=\"hljs-string\">\":\\\"</span>\\<span class=\"hljs-string\">\",\\\"</span>version\\<span class=\"hljs-string\">\":\\\"</span>\\<span class=\"hljs-string\">\",\\\"</span>loadbalance\\<span class=\"hljs-string\">\":\\\"</span><span class=\"hljs-built_in\">random</span>\\<span class=\"hljs-string\">\",\\\"</span>retries\\<span class=\"hljs-string\">\":2,\\\"</span>timeout\\<span class=\"hljs-string\">\":10000,\\\"</span>url\\<span class=\"hljs-string\">\":\\\"</span>\\<span class=\"hljs-string\">\"}\"</span>,<span class=\"hljs-string\">\"enabled\"</span>:<span class=\"hljs-literal\">true</span>}\n</code></pre>\n<p>同样可以看到之前启动 soul-examples-http时的类似log, 显然dubbo的服务也注册到了soul</p>\n<p>访问 <a href=\"http://127.0.0.1:9095/#/plug/dubbo\" target=\"_blank\" rel=\"external\">http://127.0.0.1:9095/#/plug/dubbo</a> 同样可以看到 刚起的实例服务注册了rule 和selector 到了soul上</p>\n<p>尝试通过网关访问dubbo服务, 果然成功</p>\n\n    <pre><code class=\"lang-bash\">curl  localhost:<span class=\"hljs-number\">9195</span><span class=\"hljs-meta-keyword\">/dubbo/</span><span class=\"hljs-class\">findAll\n</span>{<span class=\"hljs-string\">\"code\"</span>:<span class=\"hljs-number\">200</span>,<span class=\"hljs-string\">\"message\"</span>:<span class=\"hljs-string\">\"Access to success!\"</span>,<span class=\"hljs-string\">\"data\"</span>:{<span class=\"hljs-string\">\"name\"</span>:<span class=\"hljs-string\">\"hello world Soul Apache, findAll\"</span>,<span class=\"hljs-string\">\"id\"</span>:<span class=\"hljs-string\">\"-1845873449\"</span>}}%\n</code></pre>\n<p>dubbo注册到soul同http一样需要以下配置</p>\n\n    <pre><code class=\"lang-yaml\"><span class=\"hljs-attribute\">soul</span>:\n  <span class=\"hljs-attribute\">dubbo</span>:\n    <span class=\"hljs-attribute\">adminUrl</span>: <span class=\"hljs-attribute\">http</span>:<span class=\"hljs-comment\">//localhost:9095</span>\n    <span class=\"hljs-attribute\">contextPath</span>: /dubbo\n    <span class=\"hljs-attribute\">appName</span>: dubbo\n</code></pre>\n<p>流程与divide完全一致</p>\n<p>同divide, 使用了 AlibabaDubboServiceBeanPostProcessor 去处理 拥有 @SoulDubboClient 注解的接口</p>\n<p>通过SoulWebHandler#execute遍历注插件后执行 AbstractSoulPlugin具体实现类的execute方法, 这里留个todo:接下来详细分析</p>\n","categories":[],"tags":[{"name":"SOUL","path":"api/tags/SOUL.json"}]}